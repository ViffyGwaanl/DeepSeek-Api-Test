# DeepSeek Api Test

**版本：0.2.0  
作者：Gwaanl**

DeepSeek Api Test 是一个用于测试多模型接口性能的 Web 应用程序。项目集成了定时任务、日志记录、数据存储与自动化报告生成功能，支持对不同模型接口进行轮次测试，并以直观的 HTML 表格与图片形式展示测试结果。

---

## 目录

- [项目简介](#项目简介)
- [功能特性](#功能特性)
- [项目结构](#项目结构)
- [安装与依赖](#安装与依赖)
- [配置说明](#配置说明)
- [使用方法](#使用方法)
  - [启动应用](#启动应用)
  - [Web 界面操作](#web-界面操作)
  - [定时任务](#定时任务)
- [API 接口](#api-接口)
- [日志与数据库](#日志与数据库)
- [许可证](#许可证)
- [贡献](#贡献)
- [联系方式](#联系方式)

---

## 项目简介

本项目旨在测试不同模型接口的响应性能，通过发送预设提示词请求各接口，并统计返回结果中的完成 token 数、耗时以及 token/s 速度。测试过程分为 3 轮，每轮测试均生成详细的 HTML 表格，最终生成一份汇总报告。此外，测试结果会保存到 SQLite 数据库中，同时支持将测试结果导出为图片。

---

## 功能特性

- **多模型测试**：支持对多个模型接口进行轮流测试。
- **定时任务**：利用 APScheduler 定时触发测试任务（默认每小时执行一次）。
- **实时进度监控**：通过 Web 页面实时显示测试进度、轮次与各模型状态。
- **数据存储**：所有测试结果自动保存到 SQLite 数据库，便于后续查看和对比。
- **报告导出**：测试结果以 HTML 表格展示，并可导出为一张长图（图片）。
- **自定义提示词**：支持在线更新测试请求中的提示词内容。
- **日志记录**：详细的文件与控制台日志，便于调试与问题定位。

---

## 项目结构

```plaintext
DeepSeekApiTest/
├── app.py                 # 应用入口，初始化 Flask、注册蓝图、启动 APScheduler
├── config.py              # Flask 及 APScheduler 配置文件
├── database.py            # 数据库操作模块（初始化、保存、读取测试记录）
├── logger_setup.py        # 日志配置（文件日志与控制台日志）
├── models_config.py       # 模型接口配置文件（需根据实际情况修改）
├── scheduler_tasks.py     # 核心测试逻辑与定时任务实现
├── shared.py              # 全局共享变量（如提示词、测试进度、线程锁）
├── utils.py               # 辅助工具（HTML 表格生成、异常检测、图片导出）
├── views.py               # Flask 路由处理模块（测试启动、结果展示、历史记录）
├── requirements.txt       # 项目依赖列表
├── README.md              # 项目说明文档（当前文件）
└── LICENSE                # MIT 许可证
```

---

## 安装与依赖

### 环境要求

- Python 3.7 及以上版本
- pip 包管理器

### 安装依赖

在项目根目录下执行以下命令安装所有依赖：

```bash
pip install -r requirements.txt
```

> **注意**：  
> 部分依赖（如 `imgkit`）可能需要额外安装系统依赖或 wkhtmltopdf、wkhtmltoimage 工具，请参考相关文档进行安装。

---

## 配置说明

1. **模型配置**  
   编辑 `models_config.py` 文件，根据你的实际情况修改模型接口信息，包括：
   - `display_name`：模型展示名称
   - `url`：接口地址
   - `api_key`：接口访问密钥
   - `payload_model`（可选）：请求载荷中使用的模型标识

2. **日志与数据库**  
   - 日志文件会生成在项目根目录下，文件名为 `test.log`。
   - 测试结果将保存到 `results.db`（SQLite 数据库文件）。

3. **提示词**  
   初始提示词在 `shared.py` 中定义，可通过 Web 页面在线更新。

---

## 使用方法

### 启动应用

在项目根目录下运行以下命令启动 Flask 应用：

```bash
python app.py
```

应用启动后会自动打开浏览器并跳转至 [http://127.0.0.1:5000](http://127.0.0.1:5000)。

### Web 界面操作

- **测试启动**  
  点击“立即执行一轮测试”按钮，系统会在后台启动 3 轮测试任务。

- **更新提示词**  
  在自定义提示词输入框中输入新的提示词，点击“更新提示词”按钮即可修改测试请求中的提示词内容。

- **实时监控**  
  页面会实时显示测试进度，包括当前测试轮次、已完成模型和未完成模型的状态。

- **结果查看**  
  测试结束后，可在首页直接查看最新测试结果；点击“查看历史记录”可查看以往测试记录详情。

### 定时任务

项目使用 APScheduler 定时任务模块，每小时自动执行一次测试任务。你可以根据需要修改 `scheduler_tasks.py` 中定时任务的配置。

---

## API 接口

项目提供了一些简单的 API 接口，可通过浏览器或 HTTP 客户端进行调用：

- **启动测试**  
  `GET /start_test?timeout=300`  
  参数 `timeout` 为请求超时时间（秒）。

- **更新提示词**  
  `GET /update_prompt?prompt=新的提示词`

- **获取测试进度**  
  `GET /test_progress`  
  返回当前测试的状态与进度信息（JSON 格式）。

- **查看最新测试结果**  
  `GET /`  
  显示最新一次测试结果的详细页面。

- **查看历史记录**  
  `GET /history`  
  显示所有测试记录的列表页面。

- **查看指定记录详情**  
  `GET /result/<记录ID>`  
  显示指定测试记录的详细结果页面。

---

## 日志与数据库

- **日志**  
  所有操作及测试过程会记录到 `test.log` 文件中，同时也在控制台输出关键信息，便于调试和问题追踪。

- **数据库**  
  测试结果保存在 SQLite 数据库文件 `results.db` 中，可通过 SQLite 工具进行查询、备份或恢复操作。

---

## 许可证

本项目采用 [MIT 许可证](LICENSE)。

> **DeepSeek Api Test 由 Gwaanl构建，源代码遵循 MIT 许可证。**

---

## 贡献

欢迎对本项目提出建议、提交 Issue 或发起 Pull Request。  


---

## 联系方式

如果有任何问题或建议，请在issues联系：  
**作者：Gwaanl**  

---
